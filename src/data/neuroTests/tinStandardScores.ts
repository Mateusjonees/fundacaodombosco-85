/**
 * Tabela de Escores Padrão do TIN (Teste Infantil de Nomeação)
 * Dados extraídos da Tabela 6.2 do manual oficial
 * Faixa etária: 3-14 anos
 * 
 * Escore padrão: média = 100, desvio-padrão = 15
 * 
 * Classificações:
 * - < 70: Muito Baixa
 * - 70-84: Baixa
 * - 85-114: Média
 * - 115-129: Alta
 * - >= 130: Muito Alta
 */

type AgeKey = 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14;

// Tabela de escores padrão por idade e escore bruto
// Estrutura: rawScore -> { idade: escorePadrão }
const TIN_STANDARD_SCORES: Record<number, Partial<Record<AgeKey, number>>> = {
  1: { 3: 73, 4: 71, 5: 67, 6: 56, 7: 42, 8: 10, 9: 0 },
  2: { 3: 79, 4: 74, 5: 69, 6: 57, 7: 44, 8: 12, 9: 2 },
  3: { 3: 84, 4: 76, 5: 71, 6: 59, 7: 46, 8: 14, 9: 4 },
  4: { 3: 89, 4: 79, 5: 72, 6: 61, 7: 47, 8: 17, 9: 6 },
  5: { 3: 94, 4: 82, 5: 74, 6: 62, 7: 49, 8: 19, 9: 9 },
  6: { 3: 99, 4: 84, 5: 76, 6: 64, 7: 51, 8: 21, 9: 11 },
  7: { 3: 104, 4: 87, 5: 77, 6: 66, 7: 53, 8: 24, 9: 13 },
  8: { 3: 109, 4: 90, 5: 79, 6: 67, 7: 54, 8: 26, 9: 16 },
  9: { 3: 115, 4: 93, 5: 81, 6: 69, 7: 56, 8: 28, 9: 18 },
  10: { 3: 120, 4: 95, 5: 83, 6: 71, 7: 58, 8: 30, 9: 20 },
  11: { 3: 125, 4: 98, 5: 84, 6: 72, 7: 60, 8: 33, 9: 23 },
  12: { 3: 130, 4: 101, 5: 86, 6: 74, 7: 61, 8: 35, 9: 25, 10: 0, 11: 0 },
  13: { 3: 135, 4: 103, 5: 88, 6: 76, 7: 63, 8: 37, 9: 27, 10: 3, 11: 2 },
  14: { 3: 140, 4: 106, 5: 89, 6: 77, 7: 65, 8: 40, 9: 30, 10: 5, 11: 5 },
  15: { 3: 145, 4: 109, 5: 91, 6: 79, 7: 67, 8: 42, 9: 32, 10: 8, 11: 7 },
  16: { 3: 151, 4: 111, 5: 93, 6: 81, 7: 68, 8: 44, 9: 34, 10: 11, 11: 10 },
  17: { 3: 156, 4: 114, 5: 94, 6: 82, 7: 70, 8: 47, 9: 36, 10: 14, 11: 12 },
  18: { 3: 161, 4: 117, 5: 96, 6: 84, 7: 72, 8: 49, 9: 39, 10: 16, 11: 15 },
  19: { 3: 166, 4: 119, 5: 98, 6: 86, 7: 73, 8: 51, 9: 41, 10: 19, 11: 18 },
  20: { 3: 171, 4: 122, 5: 99, 6: 87, 7: 75, 8: 54, 9: 43, 10: 22, 11: 20, 12: 1 },
  21: { 3: 176, 4: 125, 5: 101, 6: 89, 7: 77, 8: 56, 9: 46, 10: 25, 11: 23, 12: 4, 13: 1 },
  22: { 3: 181, 4: 127, 5: 103, 6: 91, 7: 79, 8: 58, 9: 48, 10: 27, 11: 25, 12: 7, 13: 4 },
  23: { 3: 187, 4: 130, 5: 104, 6: 92, 7: 80, 8: 60, 9: 50, 10: 30, 11: 28, 12: 10, 13: 7 },
  24: { 3: 192, 4: 133, 5: 106, 6: 94, 7: 82, 8: 63, 9: 53, 10: 33, 11: 30, 12: 13, 13: 10 },
  25: { 3: 197, 4: 135, 5: 108, 6: 96, 7: 84, 8: 65, 9: 55, 10: 36, 11: 33, 12: 16, 13: 13 },
  26: { 3: 202, 4: 138, 5: 110, 6: 97, 7: 86, 8: 67, 9: 57, 10: 38, 11: 36, 12: 19, 13: 16 },
  27: { 3: 207, 4: 141, 5: 111, 6: 99, 7: 87, 8: 70, 9: 60, 10: 41, 11: 38, 12: 22, 13: 19 },
  28: { 3: 212, 4: 144, 5: 113, 6: 101, 7: 89, 8: 72, 9: 62, 10: 44, 11: 41, 12: 25, 13: 22 },
  29: { 3: 217, 4: 146, 5: 115, 6: 102, 7: 91, 8: 74, 9: 64, 10: 47, 11: 43, 12: 28, 13: 25 },
  30: { 3: 223, 4: 149, 5: 116, 6: 104, 7: 92, 8: 77, 9: 66, 10: 49, 11: 46, 12: 31, 13: 29 },
  31: { 3: 228, 4: 152, 5: 118, 6: 106, 7: 94, 8: 79, 9: 69, 10: 52, 11: 48, 12: 34, 13: 32 },
  32: { 3: 233, 4: 154, 5: 120, 6: 107, 7: 96, 8: 81, 9: 71, 10: 55, 11: 51, 12: 37, 13: 35 },
  33: { 3: 238, 4: 157, 5: 121, 6: 109, 7: 98, 8: 84, 9: 73, 10: 58, 11: 53, 12: 40, 13: 38 },
  34: { 3: 243, 4: 160, 5: 123, 6: 110, 7: 99, 8: 86, 9: 76, 10: 60, 11: 56, 12: 42, 13: 41 },
  35: { 3: 248, 4: 162, 5: 125, 6: 112, 7: 101, 8: 88, 9: 78, 10: 63, 11: 59, 12: 45, 13: 44 },
  36: { 3: 253, 4: 165, 5: 126, 6: 114, 7: 103, 8: 90, 9: 80, 10: 66, 11: 61, 12: 48, 13: 47 },
  37: { 3: 258, 4: 168, 5: 128, 6: 115, 7: 105, 8: 93, 9: 83, 10: 69, 11: 64, 12: 51, 13: 50 },
  38: { 3: 264, 4: 170, 5: 130, 6: 117, 7: 106, 8: 95, 9: 85, 10: 72, 11: 66, 12: 54, 13: 53 },
  39: { 3: 269, 4: 173, 5: 132, 6: 119, 7: 108, 8: 97, 9: 87, 10: 74, 11: 69, 12: 57, 13: 56 },
  40: { 3: 274, 4: 176, 5: 133, 6: 120, 7: 110, 8: 100, 9: 90, 10: 77, 11: 71, 12: 60, 13: 59 },
  41: { 3: 279, 4: 178, 5: 135, 6: 122, 7: 112, 8: 102, 9: 92, 10: 80, 11: 74, 12: 63, 13: 62 },
  42: { 3: 284, 4: 181, 5: 137, 6: 124, 7: 113, 8: 104, 9: 94, 10: 83, 11: 77, 12: 66, 13: 66 },
  43: { 3: 289, 4: 184, 5: 138, 6: 125, 7: 115, 8: 107, 9: 96, 10: 85, 11: 79, 12: 69, 13: 69 },
  44: { 3: 294, 4: 187, 5: 140, 6: 127, 7: 117, 8: 109, 9: 99, 10: 88, 11: 82, 12: 72, 13: 72 },
  45: { 3: 300, 4: 189, 5: 142, 6: 129, 7: 118, 8: 111, 9: 101, 10: 91, 11: 84, 12: 75, 13: 75 },
  46: { 3: 305, 4: 192, 5: 143, 6: 130, 7: 120, 8: 114, 9: 103, 10: 94, 11: 87, 12: 78, 13: 78 },
  47: { 3: 310, 4: 195, 5: 145, 6: 132, 7: 122, 8: 116, 9: 106, 10: 96, 11: 89, 12: 81, 13: 81 },
  48: { 3: 315, 4: 197, 5: 147, 6: 134, 7: 124, 8: 118, 9: 108, 10: 99, 11: 92, 12: 84, 13: 84 },
  49: { 3: 320, 4: 200, 5: 148, 6: 135, 7: 125, 8: 121, 9: 110, 10: 102, 11: 94, 12: 87, 13: 87 },
  50: { 3: 325, 4: 203, 5: 150, 6: 137, 7: 127, 8: 123, 9: 113, 10: 105, 11: 97, 12: 90, 13: 90 },
  51: { 3: 330, 4: 205, 5: 152, 6: 139, 7: 129, 8: 125, 9: 115, 10: 107, 11: 100, 12: 93, 13: 93 },
  52: { 3: 336, 4: 208, 5: 153, 6: 140, 7: 131, 8: 127, 9: 117, 10: 110, 11: 102, 12: 96, 13: 96 },
  53: { 3: 341, 4: 211, 5: 155, 6: 142, 7: 132, 8: 130, 9: 120, 10: 113, 11: 105, 12: 99, 13: 99 },
  54: { 3: 346, 4: 213, 5: 157, 6: 144, 7: 134, 8: 132, 9: 122, 10: 116, 11: 107, 12: 102, 13: 102 },
  55: { 3: 351, 4: 216, 5: 159, 6: 145, 7: 136, 8: 134, 9: 124, 10: 118, 11: 110, 12: 105, 13: 106 },
  56: { 3: 356, 4: 219, 5: 160, 6: 147, 7: 137, 8: 137, 9: 127, 10: 121, 11: 112, 12: 108, 13: 109 },
  57: { 3: 361, 4: 221, 5: 162, 6: 149, 7: 139, 8: 139, 9: 129, 10: 124, 11: 115, 12: 111, 13: 112 },
  58: { 3: 366, 4: 224, 5: 164, 6: 150, 7: 141, 8: 141, 9: 131, 10: 127, 11: 118, 12: 114, 13: 115 },
  59: { 3: 372, 4: 227, 5: 165, 6: 152, 7: 143, 8: 144, 9: 133, 10: 129, 11: 120, 12: 117, 13: 118 },
  60: { 3: 377, 4: 229, 5: 167, 6: 154, 7: 144, 8: 146, 9: 136, 10: 132, 11: 123, 12: 120, 13: 121, 14: 125 }
};

/**
 * Busca o escore padrão para um escore bruto e idade
 */
export const lookupTINStandardScore = (age: number, rawScore: number): number | null => {
  // Validar idade (3-14 anos)
  if (age < 3 || age > 14) {
    return null;
  }

  // Arredondar idade para inteiro
  const ageKey = Math.floor(age) as AgeKey;
  
  // Validar escore bruto (0-60)
  if (rawScore < 0 || rawScore > 60) {
    return null;
  }

  // Buscar na tabela
  const scoreEntry = TIN_STANDARD_SCORES[rawScore];
  if (!scoreEntry) {
    // Se o escore bruto não está na tabela, é muito baixo para a idade
    return null;
  }

  const standardScore = scoreEntry[ageKey];
  
  // Se não há escore para esta idade, o escore bruto é muito baixo
  if (standardScore === undefined) {
    return null;
  }

  return standardScore;
};

/**
 * Retorna o nome da faixa etária para exibição
 */
export const getTINAgeGroupName = (age: number): string => {
  if (age >= 3 && age <= 14) {
    return `${Math.floor(age)} anos`;
  }
  return 'Idade não suportada';
};

/**
 * Verifica se a idade está dentro da faixa do teste
 */
export const isAgeValidForTIN = (age: number): boolean => {
  return age >= 3 && age <= 14;
};
