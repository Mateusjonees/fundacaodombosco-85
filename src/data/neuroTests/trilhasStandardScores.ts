/**
 * Tabelas de Escores Padrão do Teste de Trilhas (Partes A e B)
 * Dados extraídos das Tabelas 8.2, 8.3 e 8.4 do manual oficial
 * Faixa etária: 6-14 anos
 * 
 * Escore padrão: média = 100, desvio-padrão = 15
 * Fórmula: pontuação-padrão = ([PONTUAÇÃO - média]/desvio-padrão) * 15 + 100
 * 
 * Classificações:
 * - < 70: Muito Baixa
 * - 70-84: Baixa
 * - 85-114: Média
 * - 115-129: Alta
 * - >= 130: Muito Alta
 */

type AgeKey = 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14;

// Tabela 8.2: Escores padrão para Sequências na Parte A
// Estrutura: rawScore -> { idade: escorePadrão }
const TRILHAS_A_STANDARD_SCORES: Record<number, Partial<Record<AgeKey, number>>> = {
  7: { 6: 11 },
  8: { 6: 17 },
  9: { 6: 23 },
  10: { 6: 29 },
  11: { 6: 36 },
  12: { 6: 42 },
  13: { 6: 48, 7: 9 },
  14: { 6: 54, 7: 20 },
  15: { 6: 61, 7: 30, 8: 9 },
  16: { 6: 67, 7: 41, 8: 22, 9: 4 },
  17: { 6: 73, 7: 51, 8: 34, 9: 19 },
  18: { 6: 79, 7: 62 },
  19: { 6: 79, 7: 73, 8: 47, 9: 34, 11: 11, 13: 23 },
  20: { 6: 86, 7: 73, 8: 59, 9: 49, 10: 4, 11: 30, 13: 40 },
  21: { 6: 92, 7: 83, 8: 71, 9: 64, 10: 30, 11: 50, 12: 4 },
  22: { 6: 98, 7: 94, 8: 84, 9: 79, 10: 56, 11: 69, 12: 38 },
  23: { 6: 105, 7: 104, 8: 96, 9: 94, 10: 82, 11: 89, 12: 72 },
  24: { 6: 111, 7: 115, 8: 108, 9: 109, 10: 108, 11: 108, 12: 106, 13: 105, 14: 107 },
  25: { 6: 117, 7: 125, 8: 121, 9: 124, 10: 134, 11: 128, 12: 140, 13: 122, 14: 124 },
};

// Tabela 8.3: Escores padrão para Sequências na Parte B
// Baseado nos dados do PDF (páginas 2-3)
const TRILHAS_B_STANDARD_SCORES: Record<number, Partial<Record<AgeKey, number>>> = {
  0: { 6: 82, 7: 86, 8: 82, 9: 87, 10: 68, 11: 44, 12: 39, 13: 46, 14: 31 },
  1: { 6: 87, 7: 89, 8: 86, 9: 90, 10: 71, 11: 48, 12: 43, 13: 49, 14: 35 },
  2: { 6: 91, 7: 93, 8: 89, 9: 93, 10: 74, 11: 52, 12: 47, 13: 53, 14: 40 },
  3: { 6: 95, 7: 96, 8: 93, 9: 96, 10: 77, 11: 57, 12: 51, 13: 56, 14: 44 },
  4: { 6: 99, 7: 100, 8: 96, 9: 98, 10: 80, 11: 61, 12: 55, 13: 60, 14: 48 },
  5: { 6: 103, 7: 103, 8: 99, 9: 101, 10: 83, 11: 65, 12: 59, 13: 63, 14: 52 },
  6: { 6: 107, 7: 108, 8: 107, 9: 103, 10: 104, 11: 86, 12: 69, 13: 67, 14: 56 },
  7: { 6: 112, 7: 112, 8: 110, 9: 106, 10: 107, 11: 89, 12: 73, 13: 71, 14: 60 },
  8: { 6: 116, 7: 114, 8: 110, 9: 109, 10: 92, 11: 77, 12: 71, 13: 74, 14: 64 },
  9: { 6: 120, 7: 117, 8: 113, 9: 112, 10: 95, 11: 81, 12: 75, 13: 78, 14: 68 },
  10: { 6: 125, 7: 121, 8: 117, 9: 115, 10: 98, 11: 85, 12: 79, 13: 81, 14: 72 },
  11: { 6: 129, 7: 124, 8: 120, 9: 118, 10: 101, 11: 89, 12: 83, 13: 85, 14: 76 },
  12: { 6: 133, 7: 128, 8: 124, 9: 120, 10: 104, 11: 94, 12: 87, 13: 88, 14: 80 },
  13: { 6: 137, 7: 131, 8: 127, 9: 123, 10: 107, 11: 98, 12: 91, 13: 92, 14: 85 },
  14: { 6: 142, 7: 135, 8: 131, 9: 126, 10: 110, 11: 102, 12: 95, 13: 95, 14: 89 },
  15: { 6: 146, 7: 138, 8: 134, 9: 129, 10: 113, 11: 106, 12: 99, 13: 99, 14: 93 },
  16: { 6: 150, 7: 142, 8: 138, 9: 131, 10: 116, 11: 110, 12: 103, 13: 102, 14: 97 },
  17: { 6: 154, 7: 145, 8: 141, 9: 134, 10: 119, 11: 114, 12: 107, 13: 106, 14: 101 },
  18: { 6: 159, 7: 149, 8: 145, 9: 137, 10: 122, 11: 118, 12: 111, 13: 109, 14: 105 },
  19: { 6: 163, 7: 152, 8: 148, 9: 140, 10: 125, 11: 122, 12: 115, 13: 113, 14: 109 },
  20: { 6: 167, 7: 156, 8: 152, 9: 142, 10: 128, 11: 126, 12: 119, 13: 116, 14: 113 },
  21: { 6: 171, 7: 159, 8: 155, 9: 145, 10: 131, 11: 131, 12: 123, 13: 120, 14: 117 },
  22: { 6: 176, 7: 163, 8: 159, 9: 148, 10: 134, 11: 135, 12: 127, 13: 124, 14: 121 },
  23: { 6: 180, 7: 166, 8: 162, 9: 151, 10: 137, 11: 139, 12: 131, 13: 127, 14: 125 },
  24: { 6: 184, 7: 170, 8: 166, 9: 154, 10: 140, 11: 143, 12: 135, 13: 131, 14: 129 },
};

// Tabela 8.4: Escores padrão para B-A (diferença)
const TRILHAS_BA_STANDARD_SCORES: Record<number, Partial<Record<AgeKey, number>>> = {
  '-24': { 6: 76, 7: 78, 8: 76, 9: 83, 10: 65, 11: 38, 12: 35, 13: 42, 14: 24 },
  '-23': { 6: 80, 7: 81, 8: 80, 9: 86, 10: 68, 11: 42, 12: 39, 13: 45, 14: 28 },
  '-22': { 6: 83, 7: 84, 8: 83, 9: 88, 10: 71, 11: 46, 12: 43, 13: 49, 14: 32 },
  '-21': { 6: 87, 7: 87, 8: 87, 9: 91, 10: 74, 11: 50, 12: 47, 13: 52, 14: 37 },
  '-20': { 6: 91, 7: 91, 8: 90, 9: 94, 10: 76, 11: 55, 12: 51, 13: 56, 14: 41 },
  '-19': { 6: 94, 7: 94, 8: 94, 9: 97, 10: 79, 11: 59, 12: 55, 13: 59, 14: 45 },
  '-18': { 6: 98, 7: 97, 8: 97, 9: 99, 10: 82, 11: 63, 12: 59, 13: 63, 14: 49 },
  '-17': { 6: 101, 7: 101, 8: 101, 9: 102, 10: 85, 11: 67, 12: 63, 13: 66, 14: 53 },
  '-16': { 6: 105, 7: 104, 8: 104, 9: 105, 10: 88, 11: 71, 12: 67, 13: 70, 14: 57 },
  '-15': { 6: 109, 7: 107, 8: 107, 9: 108, 10: 91, 11: 75, 12: 71, 13: 74, 14: 62 },
  '-14': { 6: 112, 7: 110, 8: 111, 9: 111, 10: 94, 11: 79, 12: 75, 13: 77, 14: 66 },
  '-13': { 6: 116, 7: 114, 8: 114, 9: 113, 10: 97, 11: 84, 12: 79, 13: 81, 14: 70 },
  '-12': { 6: 120, 7: 117, 8: 118, 9: 116, 10: 100, 11: 88, 12: 83, 13: 84, 14: 74 },
  '-11': { 6: 123, 7: 120, 8: 121, 9: 119, 10: 103, 11: 92, 12: 87, 13: 88, 14: 78 },
  '-10': { 6: 127, 7: 123, 8: 125, 9: 122, 10: 106, 11: 96, 12: 91, 13: 91, 14: 82 },
  '-9': { 6: 130, 7: 127, 8: 128, 9: 124, 10: 109, 11: 100, 12: 95, 13: 95, 14: 87 },
  '-8': { 6: 134, 7: 130, 8: 132, 9: 127, 10: 112, 11: 104, 12: 99, 13: 98, 14: 91 },
  '-7': { 6: 138, 7: 133, 8: 135, 9: 130, 10: 115, 11: 108, 12: 102, 13: 102, 14: 95 },
  '-6': { 6: 141, 7: 137, 8: 138, 9: 133, 10: 118, 11: 113, 12: 106, 13: 105, 14: 99 },
  '-5': { 6: 145, 7: 140, 8: 142, 9: 136, 10: 121, 11: 117, 12: 110, 13: 109, 14: 103 },
  '-4': { 6: 148, 7: 143, 8: 145, 9: 138, 10: 124, 11: 121, 12: 114, 13: 112, 14: 108 },
  '-3': { 6: 152, 7: 146, 8: 149, 9: 141, 10: 127, 11: 125, 12: 118, 13: 116, 14: 112 },
  '-2': { 6: 156, 7: 150, 8: 152, 9: 144, 10: 130, 11: 129, 12: 122, 13: 119, 14: 116 },
  '-1': { 6: 159, 7: 153, 8: 156, 9: 147, 10: 133, 11: 133, 12: 126, 13: 123, 14: 120 },
  '0': { 6: 163, 7: 156, 8: 159, 9: 149, 10: 136, 11: 137, 12: 130, 13: 126, 14: 124 },
};

// Converter chaves string para números na tabela B-A
const TRILHAS_BA_SCORES_MAP: Map<number, Partial<Record<AgeKey, number>>> = new Map(
  Object.entries(TRILHAS_BA_STANDARD_SCORES).map(([key, value]) => [parseInt(key), value])
);

/**
 * Busca o escore padrão para Sequências A
 */
export const lookupTrilhasAStandardScore = (age: number, rawScore: number): number | null => {
  if (age < 6 || age > 14) return null;
  
  const ageKey = Math.floor(age) as AgeKey;
  const scoreEntry = TRILHAS_A_STANDARD_SCORES[rawScore];
  
  if (!scoreEntry) return null;
  
  return scoreEntry[ageKey] ?? null;
};

/**
 * Busca o escore padrão para Sequências B
 */
export const lookupTrilhasBStandardScore = (age: number, rawScore: number): number | null => {
  if (age < 6 || age > 14) return null;
  
  const ageKey = Math.floor(age) as AgeKey;
  const scoreEntry = TRILHAS_B_STANDARD_SCORES[rawScore];
  
  if (!scoreEntry) return null;
  
  return scoreEntry[ageKey] ?? null;
};

/**
 * Busca o escore padrão para B-A (diferença)
 */
export const lookupTrilhasBAStandardScore = (age: number, diffScore: number): number | null => {
  if (age < 6 || age > 14) return null;
  
  const ageKey = Math.floor(age) as AgeKey;
  const scoreEntry = TRILHAS_BA_SCORES_MAP.get(diffScore);
  
  if (!scoreEntry) return null;
  
  return scoreEntry[ageKey] ?? null;
};

/**
 * Retorna o nome da faixa etária para exibição
 */
export const getTrilhasAgeGroupName = (age: number): string => {
  if (age >= 6 && age <= 14) {
    return `${Math.floor(age)} anos`;
  }
  return 'Idade não suportada';
};

/**
 * Verifica se a idade está dentro da faixa do teste
 */
export const isAgeValidForTrilhas = (age: number): boolean => {
  return age >= 6 && age <= 14;
};
